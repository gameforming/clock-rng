<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clock Factory Tycoon</title>
  <style>
    body {
      display: flex;
      font-family: sans-serif;
      margin: 0;
    }
    #game {
      display: grid;
      grid-template-columns: repeat(16, 40px);
      grid-template-rows: repeat(16, 40px);
      gap: 2px;
      padding: 10px;
      background: #ddd;
    }
    .tile {
      width: 40px;
      height: 40px;
      background: white;
      border: 1px solid #aaa;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .selected {
      border: 3px solid red;
    }
    #sidebar {
      width: 200px;
      padding: 10px;
      background: #eee;
    }
    button {
      width: 100%;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div id="game"></div>
  <div id="sidebar">
    <h3>Clock Factory Tycoon</h3>
    <p id="money">Money: €0</p>
    <button onclick="buyBlock('+2')">Buy +2 Block (€50)</button>
    <button onclick="buyBlock('x2')">Buy x2 Block (€100)</button>
    <button onclick="saveGame()">Save Game</button>
    <button onclick="loadGame()">Load Game</button>
  </div>

  <script>
    const gridSize = 16;
    const game = document.getElementById("game");
    const moneyDisplay = document.getElementById("money");

    let money = 0;
    const blocks = [];
    const grid = [];
    const gameState = {};

    const factory = { x: 0, y: 0, dir: "right" };
    const sell = { x: 15, y: 15 };
    let selected = factory;

    function createGrid() {
      game.innerHTML = "";
      grid.length = 0;
      for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
          const tile = document.createElement("div");
          tile.className = "tile";
          tile.onclick = () => {
            const foundBlock = blocks.find(b => b.x === x && b.y === y);
            if (foundBlock) {
              selected = foundBlock;
            } else if (x === factory.x && y === factory.y) {
              selected = factory;
            } else if (x === sell.x && y === sell.y) {
              selected = sell;
            } else {
              selected = null;
            }
            render();
          };
          grid.push({ x, y, tile });
          game.appendChild(tile);
        }
      }
      render();
    }

    function render() {
      for (const { x, y, tile } of grid) {
        tile.textContent = "";
        tile.classList.remove("selected");
        if (x === factory.x && y === factory.y) {
          tile.textContent = "🏭";
        } else if (x === sell.x && y === sell.y) {
          tile.textContent = "💰";
        } else {
          const block = blocks.find(b => b.x === x && b.y === y);
          if (block) {
            tile.textContent = block.type;
          }
        }

        if (
          selected &&
          selected.x === x &&
          selected.y === y
        ) {
          tile.classList.add("selected");
        }
      }
      moneyDisplay.textContent = `Money: €${money}`;
    }

    function moveSelected(dx, dy) {
      if (!selected) return;
      selected.x = Math.max(0, Math.min(gridSize - 1, selected.x + dx));
      selected.y = Math.max(0, Math.min(gridSize - 1, selected.y + dy));
      render();
    }

    function rotateFactory() {
      const dirs = ["right", "down", "left", "up"];
      const index = dirs.indexOf(factory.dir);
      factory.dir = dirs[(index + 1) % 4];
      render();
    }

    function buyBlock(type) {
      const cost = type === "+2" ? 50 : 100;
      if (money < cost) return alert("Not enough money!");
      const pos = findFreePosition();
      if (!pos) return alert("No space!");
      blocks.push({ x: pos.x, y: pos.y, type });
      money -= cost;
      render();
    }

    function findFreePosition() {
      for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
          if (
            !blocks.some(b => b.x === x && b.y === y) &&
            !(x === factory.x && y === factory.y) &&
            !(x === sell.x && y === sell.y)
          ) return { x, y };
        }
      }
      return null;
    }

    function update() {
      let value = 1;
      let x = factory.x;
      let y = factory.y;
      for (let i = 0; i < 10; i++) {
        switch (factory.dir) {
          case "right": x++; break;
          case "left": x--; break;
          case "down": y++; break;
          case "up": y--; break;
        }
        if (x === sell.x && y === sell.y) {
          money += value;
          break;
        }
        const block = blocks.find(b => b.x === x && b.y === y);
        if (!block) break;
        if (block.type === "+2") value += 2;
        if (block.type === "x2") value *= 2;
      }
      render();
    }

    function saveGame() {
      gameState.selected = selected && selected !== factory && selected !== sell
        ? { x: selected.x, y: selected.y }
        : selected === factory
          ? "factory"
          : selected === sell
            ? "sell"
            : null;

      localStorage.setItem("clockFactoryTycoonSave", JSON.stringify({
        money,
        factory,
        sell,
        blocks,
        selected: gameState.selected
      }));
      alert("Game opgeslagen!");
    }

    function loadGame() {
      const state = JSON.parse(localStorage.getItem("clockFactoryTycoonSave"));
      if (!state) return alert("No save found!");
      money = state.money;
      factory.x = state.factory.x;
      factory.y = state.factory.y;
      factory.dir = state.factory.dir;
      sell.x = state.sell.x;
      sell.y = state.sell.y;
      blocks.length = 0;
      for (const b of state.blocks) blocks.push({ ...b });

      if (state.selected === "factory") {
        selected = factory;
      } else if (state.selected === "sell") {
        selected = sell;
      } else if (state.selected && typeof state.selected.x === "number") {
        selected = blocks.find(b => b.x === state.selected.x && b.y === state.selected.y) || null;
      } else {
        selected = null;
      }

      render();
    }

    // Controls
    document.addEventListener("keydown", e => {
      switch (e.key) {
        case "ArrowUp": moveSelected(0, -1); break;
        case "ArrowDown": moveSelected(0, 1); break;
        case "ArrowLeft": moveSelected(-1, 0); break;
        case "ArrowRight": moveSelected(1, 0); break;
        case "r": rotateFactory(); break;
      }
    });

    createGrid();
    setInterval(update, 1000);
  </script>
</body>
</html>
