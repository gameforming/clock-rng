<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Clock Factory Tycoon</title>
  <style>
    body {
      margin: 0;
      display: flex;
      font-family: sans-serif;
      background-color: #121212;
      color: white;
      /* Zorg dat de drie containers naast elkaar staan */
      flex-direction: row;
      height: 100vh;
    }

    #game {
      display: grid;
      grid-template-columns: repeat(16, 40px);
      grid-template-rows: repeat(16, 40px);
      gap: 1px;
      background-color: #333;
      margin: 20px;
      position: relative;
      flex-shrink: 0;
    }

    .cell {
      width: 40px;
      height: 40px;
      background-color: #1e1e1e;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      border: 1px solid #444;
      position: relative;
      user-select: none;
    }

    .factory {
      background-color: #4caf50;
    }

    .sell {
      background-color: #2196f3;
    }

    .arrow {
      transform: rotate(0deg);
      transition: transform 0.2s;
      user-select: none;
    }

    .clock {
      width: 20px;
      height: 20px;
      background-color: yellow;
      border-radius: 50%;
      position: absolute;
      pointer-events: none;
    }

    .block {
      background-color: orange;
    }

    #sidebar {
      width: 250px;
      padding: 20px;
      background-color: #1e1e2f;
      display: flex;
      flex-direction: column;
      gap: 10px;
      user-select: none;
    }

    button {
      padding: 10px;
      background-color: #4caf50;
      border: none;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #45a049;
    }

    .selected {
      outline: 2px solid yellow;
      box-sizing: border-box;
    }

    #backButtonContainer {
      width: 180px;
      padding: 20px;
      background-color: #1e1e2f;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    #backButtonContainer button {
      width: 100%;
      font-size: 18px;
      padding: 15px 0;
      border-radius: 8px;
    }

  </style>
</head>
<body>
  <div id="game"></div>

  <div id="sidebar">
    <h2>Shop</h2>
    <button onclick="buyBlock('+2')">+2 Block (€<span id="costPlus2">100</span>)</button>
    <button onclick="buyBlock('x2')">x2 Block (€<span id="costX2">200</span>)</button>
    <button onclick="buyBlock('bocht')">Bocht (€500)</button>
    <p>Money: <span id="money">0</span></p>
  </div>

  <div id="backButtonContainer">
    <button onclick="window.location.href='index.html'">Back to Homepage</button>
  </div>

  <script>
    const game = document.getElementById("game");
    const size = 16;
    const grid = [];
    const clocks = [];
    let selected = null;
    let money = 0;

    let costPlus2 = 100;
    let costX2 = 200;

    const blocks = [];

    const factory = { x: 5, y: 5, type: "factory", rotation: 0 };
    const sell = { x: 10, y: 10, type: "sell", rotation: 0 };

    const directionFromRotation = (rotation) => {
      const deg = rotation % 360;
      if (deg === 0) return [1, 0];
      if (deg === 90) return [0, 1];
      if (deg === 180) return [-1, 0];
      if (deg === 270) return [0, -1];
      return [0, 0];
    };

    function createGrid() {
      game.innerHTML = "";
      for (let y = 0; y < size; y++) {
        grid[y] = [];
        for (let x = 0; x < size; x++) {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          cell.dataset.x = x;
          cell.dataset.y = y;

          if (x === factory.x && y === factory.y) {
            cell.classList.add("factory");
            cell.innerHTML = `<span class="arrow">→</span>`;
            cell.querySelector(".arrow").style.transform = `rotate(${factory.rotation}deg)`;
            if (selected === factory) cell.classList.add("selected");
          } else if (x === sell.x && y === sell.y) {
            cell.classList.add("sell");
            cell.innerHTML = "SELL";
            if (selected === sell) cell.classList.add("selected");
          } else {
            const block = blocks.find(b => b.x === x && b.y === y);
            if (block) {
              cell.classList.add("block");
              cell.textContent = block.type;
              if (selected === block) cell.classList.add("selected");
            }
          }

          cell.addEventListener("click", () => {
            if (selected) {
              selected.x = x;
              selected.y = y;
              selected = null;
            } else {
              if (x === factory.x && y === factory.y) selected = factory;
              else if (x === sell.x && y === sell.y) selected = sell;
              else {
                const block = blocks.find(b => b.x === x && b.y === y);
                if (block) selected = block;
              }
            }
            createGrid();
          });

          grid[y][x] = cell;
          game.appendChild(cell);
        }
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "r" && selected) {
        selected.rotation = (selected.rotation + 90) % 360;
        createGrid();
      }
    });

    function spawnClock() {
      const [dx, dy] = directionFromRotation(factory.rotation);
      const cx = factory.x + dx;
      const cy = factory.y + dy;

      if (cx >= 0 && cx < size && cy >= 0 && cy < size) {
        clocks.push({ x: cx, y: cy, dx, dy, value: 1 });
      }
    }

    function updateClocks() {
      for (let i = clocks.length - 1; i >= 0; i--) {
        const clock = clocks[i];

        const block = blocks.find(b => b.x === clock.x && b.y === clock.y);
        if (block && block.type === "bocht") {
          const [dx, dy] = [clock.dx, clock.dy];
          if (dx === 1 && dy === 0) [clock.dx, clock.dy] = [0, 1];
          else if (dx === 0 && dy === 1) [clock.dx, clock.dy] = [-1, 0];
          else if (dx === -1 && dy === 0) [clock.dx, clock.dy] = [0, -1];
          else if (dx === 0 && dy === -1) [clock.dx, clock.dy] = [1, 0];
        }

        clock.x += clock.dx;
        clock.y += clock.dy;

        if (block) {
          if (block.type === "+2") clock.value += 2;
          else if (block.type === "x2") clock.value *= 2;
        }

        if (clock.x === sell.x && clock.y === sell.y) {
          money += clock.value;
          document.getElementById("money").textContent = money;
          clocks.splice(i, 1);
        } else if (
          clock.x < 0 || clock.x >= size ||
          clock.y < 0 || clock.y >= size
        ) {
          clocks.splice(i, 1);
        }
      }
    }

    function renderClocks() {
      document.querySelectorAll(".clock").forEach(elem => elem.remove());
      clocks.forEach(clock => {
        if (clock.x >= 0 && clock.x < size && clock.y >= 0 && clock.y < size) {
          const clockElem = document.createElement("div");
          clockElem.classList.add("clock");
          clockElem.style.left = `${clock.x * 41 + 10}px`;
          clockElem.style.top = `${clock.y * 41 + 10}px`;
          game.appendChild(clockElem);
        }
      });
    }

    function buyBlock(type) {
      let cost = 0;
      if (type === "+2") cost = costPlus2;
      else if (type === "x2") cost = costX2;
      else if (type === "bocht") cost = 500;

      if (money >= cost) {
        money -= cost;
        document.getElementById("money").textContent = money;

        // Plaats block op eerste vrije plek
        for (let y = 0; y < size; y++) {
          for (let x = 0; x < size; x++) {
            if ((x === factory.x && y === factory.y) || (x === sell.x && y === sell.y)) continue;
            if (!blocks.find(b => b.x === x && b.y === y)) {
              blocks.push({ x, y, type, rotation: 0 });
              createGrid();
              return;
            }
          }
        }
      } else {
        alert("Niet genoeg geld!");
      }
    }

    // Opslaan en laden
    function saveGame() {
      const data = {
        money,
        factory,
        sell,
        blocks,
        clocks
      };
      localStorage.setItem("clockFactorySave", JSON.stringify(data));
      alert("Game opgeslagen!");
    }

    function loadGame() {
      const data = localStorage.getItem("clockFactorySave");
      if (data) {
        const obj = JSON.parse(data);
        money = obj.money;
        Object.assign(factory, obj.factory);
        Object.assign(sell, obj.sell);
        blocks.length = 0;
        obj.blocks.forEach(b => blocks.push(b));
        clocks.length = 0;
        obj.clocks.forEach(c => clocks.push(c));
        document.getElementById("money").textContent = money;
        createGrid();
      } else {
        alert("Geen opgeslagen game gevonden.");
      }
    }

    // Buttons toevoegen voor save/load
    const saveBtn = document.createElement("button");
    saveBtn.textContent = "Save Game";
    saveBtn.onclick = saveGame;

    const loadBtn = document.createElement("button");
    loadBtn.textContent = "Load Game";
    loadBtn.onclick = loadGame;

    document.getElementById("sidebar").appendChild(saveBtn);
    document.getElementById("sidebar").appendChild(loadBtn);

    createGrid();

    setInterval(() => {
      spawnClock();
      updateClocks();
      renderClocks();
    }, 1000);
  </script>
</body>
</html>
