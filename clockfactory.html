<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clock Factory Tycoon</title>
  <style>
    body { font-family: sans-serif; display: flex; }
    #game { display: grid; grid-template-columns: repeat(16, 32px); grid-template-rows: repeat(16, 32px); margin-right: 20px; }
    .cell { width: 32px; height: 32px; border: 1px solid #ccc; position: relative; }
    .block, .factory, .sell, .clock {
      width: 100%; height: 100%; position: absolute; top: 0; left: 0;
      display: flex; align-items: center; justify-content: center; font-size: 12px;
    }
    .factory { background: #f90; }
    .sell { background: #0c0; }
    .clock { background: #09f; border-radius: 50%; }
    .block { background: #aaa; }
    #menu { display: flex; flex-direction: column; gap: 5px; }
    button { padding: 5px; }
  </style>
</head>
<body>
  <div id="game"></div>
  <div id="menu">
    <div>Money: €<span id="money">0</span></div>
    <button onclick="buyBlock('+2')">Buy +2 (€<span id="costPlus2">50</span>)</button>
    <button onclick="buyBlock('x2')">Buy x2 (€<span id="costX2">100</span>)</button>
    <button onclick="buyBlock('bocht')">Buy ↷ (€<span id="costBocht">75</span>)</button>
    <button onclick="buyBlock('bochtL')">Buy ↶ (€<span id="costBochtL">75</span>)</button>
    <button onclick="upgradeFactory()">Upgrade Factory (€<span id="upgradeCost">200</span>)</button>
    <button onclick="saveGame()">Save Game</button>
    <button onclick="loadGame()">Load Game</button>
  </div>
  <script>
    const size = 16;
    const grid = [];
    const blocks = [];
    const clocks = [];
    const factory = { x: 0, y: 0, rotation: 0 };
    const sell = { x: 15, y: 15, rotation: 0 };
    let money = 0;
    let costPlus2 = 50, costX2 = 100, costBocht = 75, costBochtL = 75;
    let factoryUpgradeLevel = 0, factoryUpgradeCost = 200;

    function createGrid() {
      const game = document.getElementById("game");
      game.innerHTML = "";
      for (let y = 0; y < size; y++) {
        grid[y] = [];
        for (let x = 0; x < size; x++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          grid[y][x] = cell;
          game.appendChild(cell);
        }
      }
      renderBlocks();
    }

    function renderBlocks() {
      document.querySelectorAll(".block, .factory, .sell").forEach(el => el.remove());
      for (const { x, y, type, rotation } of blocks) {
        const el = document.createElement("div");
        el.className = "block";
        el.textContent = type;
        el.style.transform = `rotate(${rotation * 90}deg)`;
        grid[y][x].appendChild(el);
      }

      const f = document.createElement("div");
      f.className = "factory";
      f.textContent = "F";
      f.style.transform = `rotate(${factory.rotation * 90}deg)`;
      grid[factory.y][factory.x].appendChild(f);

      const s = document.createElement("div");
      s.className = "sell";
      s.textContent = "S";
      grid[sell.y][sell.x].appendChild(s);
    }

    document.addEventListener("keydown", e => {
      const selected = blocks.find(b => b.selected);
      if (e.key === "r") {
        if (selected) selected.rotation = (selected.rotation + 1) % 4;
        else factory.rotation = (factory.rotation + 1) % 4;
        createGrid();
      }
    });

    document.getElementById("game").addEventListener("click", e => {
      const cell = e.target.closest(".cell");
      if (!cell) return;
      const x = [...cell.parentNode.children].indexOf(cell) % size;
      const y = Math.floor([...cell.parentNode.children].indexOf(cell) / size);
      for (const b of blocks) b.selected = false;
      const block = blocks.find(b => b.x === x && b.y === y);
      if (block) block.selected = true;
    });

    function spawnClock() {
      clocks.push({
        x: factory.x,
        y: factory.y,
        dx: [1, 0, -1, 0][factory.rotation],
        dy: [0, 1, 0, -1][factory.rotation],
        value: 1 + factoryUpgradeLevel
      });
    }

    function updateClocks() {
      for (let i = clocks.length - 1; i >= 0; i--) {
        const clock = clocks[i];
        const block = blocks.find(b => b.x === clock.x && b.y === clock.y);
        if (block) {
          if (block.type === "+2") clock.value += 2;
          else if (block.type === "x2") clock.value *= 2;
          else if (block.type === "bocht") {
            clock.dx = -clock.dy;
            clock.dy = clock.dx;
          } else if (block.type === "bochtL") {
            clock.dx = clock.dy;
            clock.dy = -clock.dx;
          }
        }
        clock.x += clock.dx;
        clock.y += clock.dy;

        if (clock.x === sell.x && clock.y === sell.y) {
          money += clock.value;
          clocks.splice(i, 1);
          updateMoneyDisplay();
        }

        if (clock.x < 0 || clock.y < 0 || clock.x >= size || clock.y >= size) {
          clocks.splice(i, 1);
        }
      }
    }

    function renderClocks() {
      document.querySelectorAll(".clock").forEach(el => el.remove());
      for (const clock of clocks) {
        const el = document.createElement("div");
        el.className = "clock";
        const cell = grid[clock.y]?.[clock.x];
        if (cell) cell.appendChild(el);
      }
    }

    function updateMoneyDisplay() {
      document.getElementById("money").textContent = money;
    }

    function buyBlock(type) {
      let cost = { "+2": costPlus2, "x2": costX2, "bocht": costBocht, "bochtL": costBochtL }[type];
      if (money < cost) return alert("Not enough money!");
      money -= cost;
      updateMoneyDisplay();

      for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
          if (
            !blocks.some(b => b.x === x && b.y === y) &&
            !(x === factory.x && y === factory.y) &&
            !(x === sell.x && y === sell.y)
          ) {
            blocks.push({ x, y, type, rotation: 0 });
            if (type === "+2") {
              costPlus2 = Math.floor(costPlus2 * 1.15);
              document.getElementById("costPlus2").textContent = costPlus2;
            } else if (type === "x2") {
              costX2 = Math.floor(costX2 * 1.15);
              document.getElementById("costX2").textContent = costX2;
            } else if (type === "bocht") {
              costBocht = Math.floor(costBocht * 1.15);
              document.getElementById("costBocht").textContent = costBocht;
            } else if (type === "bochtL") {
              costBochtL = Math.floor(costBochtL * 1.15);
              document.getElementById("costBochtL").textContent = costBochtL;
            }
            createGrid();
            return;
          }
        }
      }
    }

    function upgradeFactory() {
      if (money < factoryUpgradeCost) return alert("Not enough money!");
      money -= factoryUpgradeCost;
      factoryUpgradeLevel++;
      factoryUpgradeCost = Math.floor(factoryUpgradeCost * 1.5);
      updateMoneyDisplay();
      document.getElementById("upgradeCost").textContent = factoryUpgradeCost;
    }

    function saveGame() {
      const data = {
        money, blocks, factory, sell,
        costPlus2, costX2, costBocht, costBochtL,
        factoryUpgradeLevel, factoryUpgradeCost
      };
      localStorage.setItem("clockFactorySave", JSON.stringify(data));
      alert("Game saved!");
    }

    function loadGame() {
      const data = JSON.parse(localStorage.getItem("clockFactorySave"));
      if (!data) return alert("No save found!");
      money = data.money;
      blocks.length = 0; blocks.push(...data.blocks);
      Object.assign(factory, data.factory);
      Object.assign(sell, data.sell);
      costPlus2 = data.costPlus2; costX2 = data.costX2;
      costBocht = data.costBocht; costBochtL = data.costBochtL;
      factoryUpgradeLevel = data.factoryUpgradeLevel;
      factoryUpgradeCost = data.factoryUpgradeCost;
      updateMoneyDisplay();
      document.getElementById("costPlus2").textContent = costPlus2;
      document.getElementById("costX2").textContent = costX2;
      document.getElementById("costBocht").textContent = costBocht;
      document.getElementById("costBochtL").textContent = costBochtL;
      document.getElementById("upgradeCost").textContent = factoryUpgradeCost;
      createGrid();
    }

    createGrid();
    setInterval(() => {
      spawnClock();
      updateClocks();
      renderClocks();
    }, 1000);
  </script>
</body>
</html>
