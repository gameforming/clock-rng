<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>MineSell 2D - Player Movement 2 Blocks High</title>
<style>
  body { margin: 0; overflow: hidden; background: #333; }
  canvas { display: block; background: #99ccff; cursor: none; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const BLOCK_SIZE = 32;
const VIEWPORT_WIDTH = window.innerWidth;
const VIEWPORT_HEIGHT = window.innerHeight;

canvas.width = VIEWPORT_WIDTH;
canvas.height = VIEWPORT_HEIGHT;

const BLOCK_TYPES = {
  0: {name: 'Air', color: '#87ceeb'},
  1: {name: 'Grass', color: '#228B22'},
  2: {name: 'Stone', color: '#7D7D7D'},
  3: {name: 'Wood', color: '#A0522D'},
  4: {name: 'Leaves', color: '#32CD32'},
  5: {name: 'Iron', color: '#D8D8D8'},
  6: {name: 'Diamond', color: '#00FFFF'},
  7: {name: 'Coal', color: '#2F2F2F'},
  8: {name: 'Gold', color: '#FFD700'}
};

const worldData = new Map();

function getBlockType(x, y) {
  if (y < 10) return 0;
  if (y === 10) return 1;

  if (y > 10 && y < 15) return 2;

  if (y >= 15) {
    const n = Math.abs((x * 31 + y * 17)) % 100;
    if (n < 2) return 6;
    if (n < 7) return 8;
    if (n < 17) return 5;
    if (n < 32) return 7;
    return 2;
  }

  if (y === 9 && Math.abs(x) % 15 === 0) return 3;
  if ((y === 8 || y === 7) && Math.abs(x) % 15 === 0) return 4;

  return 0;
}

function generateWorldChunk(cx, cy, radius = 15) {
  for (let x = cx - radius; x <= cx + radius; x++) {
    for (let y = cy - radius; y <= cy + radius; y++) {
      const key = `${x},${y}`;
      if (!worldData.has(key)) {
        worldData.set(key, getBlockType(x, y));
      }
    }
  }
}

const player = {
  x: 0,
  y: 9,         // Player startpositie
  width: 0.8,
  height: 2,
  speed: 0.12
};

let worldOffsetX = player.x - (VIEWPORT_WIDTH / BLOCK_SIZE) / 2;
let worldOffsetY = player.y - (VIEWPORT_HEIGHT / BLOCK_SIZE) / 2;

generateWorldChunk(player.x, player.y);

// *** Hier staat de collision-check ***
function isSolidBlock(x, y) {
  const blockId = worldData.get(`${Math.floor(x)},${Math.floor(y)}`);
  if (blockId === undefined) return false;

  // air, wood en leaves zijn niet solid
  if (blockId === 0 || blockId === 3 || blockId === 4) return false;

  // alle andere blokken zijn solid
  return true;
}

function canMoveTo(newX, newY) {
  // Controleer alle 4 hoeken van de player hitbox
  const corners = [
    {x: newX, y: newY},
    {x: newX + player.width, y: newY},
    {x: newX, y: newY + player.height},
    {x: newX + player.width, y: newY + player.height}
  ];

  for (const corner of corners) {
    if (isSolidBlock(corner.x, corner.y)) {
      return false;
    }
  }
  return true;
}

const keysPressed = {};
window.addEventListener('keydown', e => {
  keysPressed[e.key.toLowerCase()] = true;
});
window.addEventListener('keyup', e => {
  keysPressed[e.key.toLowerCase()] = false;
});

function update() {
  let newX = player.x;
  let newY = player.y;

  if (keysPressed['a']) newX -= player.speed;
  if (keysPressed['d']) newX += player.speed;
  if (keysPressed['w']) newY -= player.speed;
  if (keysPressed['s']) newY += player.speed;

  if (canMoveTo(newX, player.y)) player.x = newX;
  if (canMoveTo(player.x, newY)) player.y = newY;

  worldOffsetX = player.x - (VIEWPORT_WIDTH / BLOCK_SIZE) / 2;
  worldOffsetY = player.y - (VIEWPORT_HEIGHT / BLOCK_SIZE) / 2;

  generateWorldChunk(Math.floor(player.x), Math.floor(player.y));
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const blocksHoriz = Math.ceil(VIEWPORT_WIDTH / BLOCK_SIZE) + 2;
  const blocksVert = Math.ceil(VIEWPORT_HEIGHT / BLOCK_SIZE) + 2;

  const startX = Math.floor(worldOffsetX);
  const startY = Math.floor(worldOffsetY);

  for (let x = startX; x < startX + blocksHoriz; x++) {
    for (let y = startY; y < startY + blocksVert; y++) {
      const key = `${x},${y}`;
      const blockId = worldData.get(key) ?? 0;
      const block = BLOCK_TYPES[blockId];
      const screenX = (x - worldOffsetX) * BLOCK_SIZE;
      const screenY = (y - worldOffsetY) * BLOCK_SIZE;

      ctx.fillStyle = block.color;
      ctx.fillRect(screenX, screenY, BLOCK_SIZE, BLOCK_SIZE);

      ctx.strokeStyle = '#555';
      ctx.strokeRect(screenX, screenY, BLOCK_SIZE, BLOCK_SIZE);
    }
  }

  const playerScreenX = VIEWPORT_WIDTH / 2 - (player.width * BLOCK_SIZE) / 2;
  const playerScreenY = VIEWPORT_HEIGHT / 2 - (player.height * BLOCK_SIZE) / 2;

  ctx.fillStyle = 'red';
  ctx.fillRect(playerScreenX, playerScreenY, player.width * BLOCK_SIZE, player.height * BLOCK_SIZE);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();

</script>
</body>
</html>
